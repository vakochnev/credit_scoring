# üß™ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è Credit Scoring API.

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ conftest.py              # –§–∏–∫—Å—Ç—É—Ä—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ test_auth.py             # –¢–µ—Å—Ç—ã –¥–ª—è shared/auth.py
‚îú‚îÄ‚îÄ test_models.py           # –¢–µ—Å—Ç—ã –¥–ª—è shared/models.py
‚îú‚îÄ‚îÄ test_data_processing.py  # –¢–µ—Å—Ç—ã –¥–ª—è shared/data_processing.py
‚îú‚îÄ‚îÄ test_api.py              # –¢–µ—Å—Ç—ã –¥–ª—è API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
‚îî‚îÄ‚îÄ README.md                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∞–º
```

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

–ò–ª–∏ —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install pytest pytest-cov pytest-asyncio httpx
```

### 2. –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

#### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
pytest -v

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
pytest tests/test_auth.py

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest tests/test_auth.py::TestPasswordHashing::test_get_password_hash
```

#### –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º

```bash
# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
pytest --cov=app --cov=shared --cov-report=html

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
# Linux/Mac:
xdg-open htmlcov/index.html  # –∏–ª–∏ open htmlcov/index.html –Ω–∞ Mac
# Windows:
start htmlcov/index.html
```

#### –ó–∞–ø—É—Å–∫ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏

```bash
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç–æ–≤
pytest -m unit

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
pytest -m auth

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ API
pytest -m api

# –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
pytest -m "not slow"
```

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

### –¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ

- **–ú–∏–Ω–∏–º—É–º**: 50%
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è**: 70%+
- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏**: 80%+

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è —Å –≤—ã–≤–æ–¥–æ–º –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫
pytest --cov=app --cov=shared --cov-report=term-missing

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è —Å –ø–æ—Ä–æ–≥–æ–º
pytest --cov=app --cov=shared --cov-fail-under=50
```

## üß© –§–∏–∫—Å—Ç—É—Ä—ã

–í—Å–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `tests/conftest.py`:

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- **`db_session`**: –¢–µ—Å—Ç–æ–≤–∞—è —Å–µ—Å—Å–∏—è –ë–î (SQLite –≤ –ø–∞–º—è—Ç–∏)
- **`test_user`**: –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é "user"
- **`test_admin`**: –¢–µ—Å—Ç–æ–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- **`test_analyst`**: –¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫

### JWT —Ç–æ–∫–µ–Ω—ã

- **`access_token`**: Access —Ç–æ–∫–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **`admin_token`**: Access —Ç–æ–∫–µ–Ω –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- **`analyst_token`**: Access —Ç–æ–∫–µ–Ω –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### FastAPI –∫–ª–∏–µ–Ω—Ç—ã

- **`client`**: –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
- **`authenticated_client`**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç
- **`admin_client`**: –ö–ª–∏–µ–Ω—Ç —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- **`analyst_client`**: –ö–ª–∏–µ–Ω—Ç —Å –ø—Ä–∞–≤–∞–º–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

- **`sample_loan_request`**: –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∫—Ä–µ–¥–∏—Ç
- **`sample_feedback_request`**: –ü—Ä–∏–º–µ—Ä —Ñ–∏–¥–±—ç–∫–∞
- **`sample_login_request`**: –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ª–æ–≥–∏–Ω

## üìù –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞

```python
def test_my_function():
    """
    –û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞.
    
    –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–∞:
    1. Arrange (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞) - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    2. Act (–¥–µ–π—Å—Ç–≤–∏–µ) - –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
    3. Assert (–ø—Ä–æ–≤–µ—Ä–∫–∞) - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    """
    # Arrange
    input_data = {"key": "value"}
    expected_result = "expected"
    
    # Act
    result = my_function(input_data)
    
    # Assert
    assert result == expected_result
```

### –ü—Ä–∏–º–µ—Ä —Å —Ñ–∏–∫—Å—Ç—É—Ä–æ–π

```python
def test_with_fixture(test_user, db_session):
    """–¢–µ—Å—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–∏–∫—Å—Ç—É—Ä—ã"""
    assert test_user.username == "testuser"
    assert test_user.is_active is True
    assert test_user.role == "user"
```

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞

```python
def test_api_endpoint(authenticated_client):
    """–¢–µ—Å—Ç API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞"""
    response = authenticated_client.post(
        "/endpoint",
        json={"data": "value"}
    )
    
    assert response.status_code == 200
    assert "key" in response.json()
    assert response.json()["key"] == "expected_value"
```

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏—Å–∫–ª—é—á–µ–Ω–∏–π

```python
def test_exception_handling():
    """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π"""
    with pytest.raises(ValueError) as exc_info:
        function_that_raises_error()
    
    assert "error message" in str(exc_info.value)
```

## üîç –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤:

```python
@pytest.mark.unit
def test_unit_function():
    """Unit —Ç–µ—Å—Ç"""
    pass

@pytest.mark.integration
def test_integration():
    """Integration —Ç–µ—Å—Ç"""
    pass

@pytest.mark.slow
def test_slow_operation():
    """–ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç"""
    pass

@pytest.mark.auth
def test_authentication():
    """–¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"""
    pass

@pytest.mark.api
def test_api_endpoint():
    """–¢–µ—Å—Ç API"""
    pass
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### –ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤

1. **–ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º**
2. **–¢–µ—Å—Ç—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã —Å `scope="function"` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö**

### –ú–æ–∫–∏ –∏ –∑–∞–≥–ª—É—à–∫–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (API, —Ñ–∞–π–ª—ã, –ë–î)
2. **–ú–æ–∫–∏—Ä—É–π—Ç–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** (ML –º–æ–¥–µ–ª–∏, SHAP)
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö**

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

1. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ 80%+**
2. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤—Å–µ –≤–µ—Ç–∫–∏ —É—Å–ª–æ–≤–∏–π** (if/else)
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** (exceptions)

## üìö –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

### –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª—è

```python
def test_get_password_hash():
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ö–µ—à–∞ –ø–∞—Ä–æ–ª—è"""
    password = "testpass123"
    hash1 = get_password_hash(password)
    hash2 = get_password_hash(password)
    
    # –•–µ—à–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏ (–∏–∑-–∑–∞ —Å–æ–ª–∏)
    assert hash1 != hash2
    # –•–µ—à–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞–º–∏
    assert isinstance(hash1, str)
```

### –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏

```python
def test_loan_request_valid(sample_loan_request):
    """–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –≤–∞–ª–∏–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∫—Ä–µ–¥–∏—Ç"""
    request = LoanRequest(**sample_loan_request)
    
    assert request.person_age == 35
    assert request.person_income == 75000
```

### –¢–µ—Å—Ç API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π

```python
def test_predict_requires_auth(client, sample_loan_request):
    """–¢–µ—Å—Ç, —á—Ç–æ /predict —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é"""
    response = client.post("/predict", json=sample_loan_request)
    
    assert response.status_code == 403
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `pytest.ini`:

- **testpaths**: –ü—É—Ç–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
- **markers**: –ú–∞—Ä–∫–µ—Ä—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
- **addopts**: –û–ø—Ü–∏–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **coverage**: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞

## üìä –û—Ç—á—ë—Ç—ã

### –¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç

```bash
pytest -v --cov=app --cov=shared --cov-report=term-missing
```

### HTML –æ—Ç—á—ë—Ç

```bash
pytest --cov=app --cov=shared --cov-report=html
open htmlcov/index.html
```

### XML –æ—Ç—á—ë—Ç (–¥–ª—è CI/CD)

```bash
pytest --cov=app --cov=shared --cov-report=xml
```

## üö® –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º—ã —Å –∏–º–ø–æ—Ä—Ç–∞–º–∏

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/credit_scoring

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
pip install -r requirements.txt
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

–¢–µ—Å—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≤—Ä–µ–º–µ–Ω–Ω—É—é SQLite –ë–î –≤ –ø–∞–º—è—Ç–∏, –ø–æ—ç—Ç–æ–º—É –Ω–µ —Ç—Ä–µ–±—É—é—Ç —Ä–µ–∞–ª—å–Ω–æ–π –ë–î.

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–∫—Ä—ã—Ç–∏–µ –≤–∫–ª—é—á–µ–Ω–æ
pytest --cov=app --cov=shared --cov-report=term
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Pytest –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.pytest.org/)
- [FastAPI Testing](https://fastapi.tiangolo.com/tutorial/testing/)
- [Pydantic Testing](https://docs.pydantic.dev/latest/usage/testing/)
- [SQLAlchemy Testing](https://docs.sqlalchemy.org/en/20/orm/session_transaction.html#joining-a-session-into-an-external-transaction-such-as-for-test-suites)

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2025-01-27

