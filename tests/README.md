# üß™ –¢–µ—Å—Ç—ã –¥–ª—è Credit Scoring API

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã Credit Scoring API.

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

```
tests/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ conftest.py              # –§–∏–∫—Å—Ç—É—Ä—ã –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
‚îú‚îÄ‚îÄ test_auth.py             # –¢–µ—Å—Ç—ã –¥–ª—è shared/auth.py
‚îú‚îÄ‚îÄ test_models.py           # –¢–µ—Å—Ç—ã –¥–ª—è shared/models.py
‚îú‚îÄ‚îÄ test_data_processing.py  # –¢–µ—Å—Ç—ã –¥–ª—è shared/data_processing.py
‚îú‚îÄ‚îÄ test_api.py              # –¢–µ—Å—Ç—ã –¥–ª—è API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
‚îî‚îÄ‚îÄ README.md                # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
pytest

# –ó–∞–ø—É—Å–∫ —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
pytest -v

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ —Ç–µ—Å—Ç–æ–≤
pytest tests/test_auth.py

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
pytest tests/test_auth.py::TestPasswordHashing::test_get_password_hash
```

### –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º

```bash
# –ó–∞–ø—É—Å–∫ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∫–æ–¥–∞
pytest --cov=app --cov=shared --cov-report=html

# –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
open htmlcov/index.html
```

### –ó–∞–ø—É—Å–∫ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏

```bash
# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç–æ–≤
pytest -m unit

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
pytest -m auth

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ API
pytest -m api

# –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
pytest -m "not slow"
```

## üìä –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: **50%+**

–¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

```bash
pytest --cov=app --cov=shared --cov-report=term-missing
```

## üß© –§–∏–∫—Å—Ç—É—Ä—ã

–í—Å–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `conftest.py`:

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

- `db_session`: –¢–µ—Å—Ç–æ–≤–∞—è —Å–µ—Å—Å–∏—è –ë–î (SQLite –≤ –ø–∞–º—è—Ç–∏)
- `test_user`: –¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é "user"
- `test_admin`: –¢–µ—Å—Ç–æ–≤—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
- `test_analyst`: –¢–µ—Å—Ç–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫

### JWT —Ç–æ–∫–µ–Ω—ã

- `access_token`: Access —Ç–æ–∫–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `admin_token`: Access —Ç–æ–∫–µ–Ω –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `analyst_token`: Access —Ç–æ–∫–µ–Ω –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### FastAPI –∫–ª–∏–µ–Ω—Ç—ã

- `client`: –ë–∞–∑–æ–≤—ã–π —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
- `authenticated_client`: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç
- `admin_client`: –ö–ª–∏–µ–Ω—Ç —Å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `analyst_client`: –ö–ª–∏–µ–Ω—Ç —Å –ø—Ä–∞–≤–∞–º–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

### –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

- `sample_loan_request`: –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∫—Ä–µ–¥–∏—Ç
- `sample_feedback_request`: –ü—Ä–∏–º–µ—Ä —Ñ–∏–¥–±—ç–∫–∞
- `sample_login_request`: –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ª–æ–≥–∏–Ω

## üìù –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ—Å—Ç–æ–≤

### –ü—Ä–∏–º–µ—Ä unit —Ç–µ—Å—Ç–∞

```python
def test_my_function():
    """–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞"""
    # Arrange (–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞)
    input_data = {"key": "value"}
    
    # Act (–¥–µ–π—Å—Ç–≤–∏–µ)
    result = my_function(input_data)
    
    # Assert (–ø—Ä–æ–≤–µ—Ä–∫–∞)
    assert result == expected_value
```

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ —Å —Ñ–∏–∫—Å—Ç—É—Ä–æ–π

```python
def test_with_fixture(test_user, db_session):
    """–¢–µ—Å—Ç —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–∏–∫—Å—Ç—É—Ä—ã"""
    assert test_user.username == "testuser"
    assert test_user.is_active is True
```

### –ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–∞ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞

```python
def test_api_endpoint(authenticated_client):
    """–¢–µ—Å—Ç API —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞"""
    response = authenticated_client.post(
        "/endpoint",
        json={"data": "value"}
    )
    
    assert response.status_code == 200
    assert "key" in response.json()
```

## üîç –ú–∞—Ä–∫–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤:

```python
@pytest.mark.unit
def test_unit_function():
    """Unit —Ç–µ—Å—Ç"""
    pass

@pytest.mark.integration
def test_integration():
    """Integration —Ç–µ—Å—Ç"""
    pass

@pytest.mark.slow
def test_slow_operation():
    """–ú–µ–¥–ª–µ–Ω–Ω—ã–π —Ç–µ—Å—Ç"""
    pass
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ò–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º
2. **–û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã —Å `scope="function"` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
3. **–ú–æ–∫–∏**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–∫–∏ –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–º–æ–¥–µ–ª–∏ ML, —Ñ–∞–π–ª—ã)
4. **–ü–æ–∫—Ä—ã—Ç–∏–µ**: –°—Ç—Ä–µ–º–∏—Ç–µ—Å—å –∫ –ø–æ–∫—Ä—ã—Ç–∏—é –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ 80%+

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Pytest –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://docs.pytest.org/)
- [FastAPI Testing](https://fastapi.tiangolo.com/tutorial/testing/)
- [Pydantic Testing](https://docs.pydantic.dev/latest/usage/testing/)

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 2025-01-27

